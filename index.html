<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First 100 Alaners</title>
    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <!-- PapaParse for CSV processing -->
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9fafb;
        }
        #root {
            margin: 0 auto;
            max-width: 800px;
            padding: 20px;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .timer {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background-color: #f0f9ff;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .timer.ending {
            color: #b91c1c;
            background-color: #fee2e2;
        }
        .message {
            margin: 16px 0;
            padding: 12px;
            border-radius: 4px;
        }
        .error {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .success {
            background-color: #dcfce7;
            color: #166534;
        }
        .hint-button {
            background-color: #f59e0b;
            margin-right: 5px;
        }
        .hint-button.active {
            background-color: #d97706;
        }
        .employee-list {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .employee-list-header {
            background-color: #1f2937;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }
        .employee-table {
            width: 100%;
            border-collapse: collapse;
        }
        .employee-table th, .employee-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .employee-table th {
            background-color: #f3f4f6;
        }
        .employee-table tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .hidden-name {
            color: #9ca3af;
        }
        .sticky-search {
            position: sticky;
            top: 0;
            background-color: white;
            padding: 10px 0;
            z-index: 10;
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .leaderboard-table th, .leaderboard-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .leaderboard-table th {
            background-color: #f3f4f6;
        }
        .highlight-row {
            background-color: #ecfdf5;
        }
        .start-button {
            background-color: #22c55e;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        .finish-button {
            background-color: #ef4444;
            color: white;
            padding: 10px 20px;
            font-weight: bold;
            margin-top: 10px;
        }
        .actions-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        // Firebase initialization
        const firebaseConfig = {
            apiKey: "AIzaSyCrvRv5dxD4bwlVoMsX2BnKTzp58UdOg2g",
            authDomain: "first-100-alaners.firebaseapp.com",
            projectId: "first-100-alaners",
            storageBucket: "first-100-alaners.firebasestorage.app",
            messagingSenderId: "996377669747",
            appId: "1:996377669747:web:d27ab25e99d6c58278fa06",
            measurementId: "G-73746XWZ6C"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Complete employee data
        const donneesBrutes = `employee_id,first_name,last_name,original_start_date,community,role,first_initial,last_initial
0,Jean-Charles,Samuelian,"1 Jan, 2016",Co-founders,CEO,J,S
1,Charles,Gorintin,"1 Jan, 2016",Co-founders,CTO,C,G
3,Antoine,Lizee,"9 May, 2016",Data,Full Stack Data Scientist,A,L
4,Robert,Zyskowski,"23 May, 2016",Engineering,Software Engineer,R,Z
6,Paul,Sauveplane,"20 Jun, 2016",Market and Bet Owners,Alaner Experience Lead,P,S
8,Fabrice,Staad,"1 Aug, 2016",Market and Bet Owners,Unit Lead - France,F,S
10,Kevin,Aserraf,"6 Mar, 2017",Marketing,Product Marketing,K,A
13,Olivier,Sambourg,"6 Jun, 2017",Engineering,Software Engineer,O,S
15,James,Whitbeck,"4 Sep, 2017",Engineering,Software Engineer,J,W
19,Leo,Andres,"8 Jan, 2018",Care,Care Crew Lead,L,A
23,Vincent,Brachet,"9 Apr, 2018",Sales,Sales Crew Lead,V,B
22,Clement,Mennesson,"4 Jun, 2018",Product Management,Product Manager,C,M
24,Thomas,Rolf,"18 Jun, 2018",Product Management,Community Lead,T,R
28,Marie,Hardel,"2 Jul, 2018",Care,Community Lead,M,H
34,Cyril,Vinot,"3 Jul, 2018",Data,Full Stack Data Scientist,C,V
46,Benjamin,Benouarka,"24 Sep, 2018",IT,IT Ops Specialist,B,B
44,Marion,Doumeingts,"1 Oct, 2018",Design and Research,Product Designer,M,D
57,Eleonore,Adrian,"1 Oct, 2018",Sales,Sales Crew Lead,E,A
38,Laurane,Maitrel,"8 Oct, 2018",Product Management,Product Manager,L,M
47,Julien,Chenat,"15 Oct, 2018",Design and Research,Product Designer,J,C
60,Naïm,Smutz,"22 Oct, 2018",Care,Product Specialist,N,S
45,Lucie,Leflour,"29 Oct, 2018",Sales,Sales Lead,L,L
51,Chloe,Legrand,"12 Nov, 2018",Care,Care Ops,C,L
61,Mihaela,Albu,"12 Nov, 2018",Finance,Community Lead,M,A
65,Berangere,Giraud,"21 Nov, 2018",Care,Customer Support Specialist - Entreprise,B,G
55,Antoine,Moulet,"1 Dec, 2018",Product Management,Product Manager,A,M
64,Augustin,Mine,"7 Jan, 2019",Market and Bet Owners,Community Lead,A,M
58,Jean,Barloy,"14 Jan, 2019",Engineering,Software Engineer,J,B
66,Thierry,Godfroid,"4 Feb, 2019",Engineering,Software Engineer,T,G
77,Victor,Dancette,"1 Apr, 2019",Sales,Sales Crew Lead,V,D
84,Claire,Lacroix,"1 Apr, 2019",Operations,Ops Coordinator,C,L
83,Ariane,Bayat,"15 Apr, 2019",Sales,Sales Crew Lead,A,B
70,Paulo,Gemelgo,"6 May, 2019",Insurance,Insurance Business,P,G
86,Thomas,Mollard,"20 May, 2019",Engineering,Software Engineer,T,M
102,Stephane,Soulier,"20 May, 2019",Data,Full Stack Data Scientist,S,S
82,Antoine,Jackson,"17 Jun, 2019",Engineering,Software Engineer,A,J
97,Flavie,de The,"17 Jun, 2019",Data,Full Stack Data Scientist,F,d
87,Remi,Schockmel,"1 Jul, 2019",Sales,Sales Crew Lead,R,S
94,Guillaume,Nevoux,"1 Jul, 2019",IT,IT Ops Specialist,G,N
100,Remy-Christophe,Schermesser,"1 Jul, 2019",Engineering,Engineering Unit Referent,R,S
112,Charles,Dusser,"1 Jul, 2019",Business Strategy and Operations,Community Lead,C,D
99,Simon,Perre,"15 Jul, 2019",Operations,Ops Builder,S,P
123,Clemence,Collon,"19 Aug, 2019",Operations,Ops Coordinator,C,C
131,Fanette,Lopez,"19 Aug, 2019",Care,Knowledge Specialist,F,L
117,Thomas,Repichet,"2 Sep, 2019",Sales,Sales Crew Lead,T,R
120,Pierre-Yves,Caneill,"2 Sep, 2019",Engineering,Software Engineer,P,C
116,Lorraine,Pipart,"16 Sep, 2019",Operations,Ops Coordinator,L,P
128,Alexandre,Gerlic,"16 Sep, 2019",Engineering,Community Lead,A,G
114,Clement,Sixdenier,"7 Oct, 2019",Sales,Account Manager,C,S
121,David,Merckle,"7 Oct, 2019",Engineering,Engineering Unit Referent,D,M
132,Manon,Trabuc,"7 Oct, 2019",People,People Ops,M,T
143,Florian,Gagnadre,"7 Oct, 2019",Engineering,Software Engineer,F,G
149,Lucie,Paladino,"7 Oct, 2019",Workplace,Community Lead,L,P
134,Vincent,Perrot,"21 Oct, 2019",Operations,Ops Coordinator,V,P
154,Maxence,Bouret,"21 Oct, 2019",Engineering,Software Engineer,M,B
122,Lucie,Touchais,"4 Nov, 2019",People,People Growth,L,T
137,Heloïse,Poras,"4 Nov, 2019",Operations,Ops Coordinator,H,P
155,Sophie,Bussieres Cauberghs,"4 Nov, 2019",Operations,Community Lead,S,B
141,Julie,Rossi,"18 Nov, 2019",Engineering,Software Engineer,J,R
152,Ludovic,Bauple,"20 Nov, 2019",Sales,Revenue Lead,L,B
138,Caroline,Carre,"2 Dec, 2019",Care,Care Crew Lead,C,C
159,Juliette,Raimbault,"2 Dec, 2019",People,Community Lead,J,R
163,Maryline,Lefebvre,"16 Dec, 2019",Operations,Ops Coordinator,M,L
168,Laure,Bonnefoi,"16 Dec, 2019",Care,Product Specialist,L,B
178,Lea,Vallerian,"16 Dec, 2019",Operations,Ops Coordinator,L,V
145,Ujala,Anis,"20 Jan, 2020",Design and Research,Community Lead,U,A
166,Caroline,Boudard,"3 Feb, 2020",Care,Product Specialist,C,B
181,Thomas,Dudouet,"3 Feb, 2020",Engineering,Software Engineer,T,D
179,Anastasia,Melnichenko,"17 Feb, 2020",Design and Research,Product Designer,A,M
172,Marc,Faget,"2 Mar, 2020",Finance,Finance,M,F
201,Romain,Stourm,"6 Apr, 2020",Sales,Sales Crew Lead,R,S
204,Donatien,Laplace,"6 Apr, 2020",Sales,Account Executive,D,L
216,Gregoire,Roussel,"6 Apr, 2020",Sales,Account Executive,G,R
193,Maxime,Robinet,"4 May, 2020",Design and Research,Product Designer,M,R
195,Emilie,Quellec,"4 May, 2020",Sales,Account Executive,E,Q
196,Thomas,Porez,"4 May, 2020",Data,Full Stack Data Scientist,T,P
197,Timna,Ehrmann,"4 May, 2020",Data,Full Stack Data Scientist,T,E
221,Brecht,Verhamme,"4 May, 2020",Operations,Ops Builder,B,V
223,Mohamed Ghazi,Benabid,"18 May, 2020",Business Strategy and Operations,Sales Strategist,M,B
227,Marie-Helene,Stoltz,"18 May, 2020",Business Strategy and Operations,CRM manager,M,S
236,Thibault,Devalle-Predieri,"18 May, 2020",Sales,Account Executive,T,D
210,Mathieu,Ghaleb,"1 Jun, 2020",Engineering,Software Engineer,M,G
237,Victor,Boutin,"1 Jun, 2020",Sales,Account Executive,V,B
235,Laurent,Guerin,"15 Jun, 2020",Insurance,Community Lead,L,G
242,Marion,Bergeret,"15 Jun, 2020",Corporate,Corporate Lead,M,B
245,Simon,Verlaque,"15 Jun, 2020",Business Strategy and Operations,Sales Strategist,S,V
247,Vincent,Poulain,"15 Jun, 2020",Engineering,Software Engineer,V,P
230,Thomas,Quinot,"6 Jul, 2020",Corporate,Information security lead / CISO,T,Q
249,Estelle,Pasteau,"20 Jul, 2020",Talent,Talent,E,P
258,Tristan,du Boys,"20 Jul, 2020",Operations,Ops Coordinator,T,d
234,Theo,Sermet,"17 Aug, 2020",Insurance,Insurance Products,T,S
248,Sebastien,de Larquier,"17 Aug, 2020",Data,Community Lead,S,d
240,Aurelie,Fliedel,"31 Aug, 2020",Marketing,Community Lead,A,F
257,David,Rousselie,"31 Aug, 2020",Engineering,Software Engineer,D,R
261,Alfredo,Schoch,"31 Aug, 2020",Operations,Ops Builder,A,S
259,Sebastien,Fredeau,"14 Sep, 2020",Market and Bet Owners,Unit Lead - Belgium,S,F
251,Josephine,Gaillet,"28 Sep, 2020",Care,Care Ops,J,G
254,Dries,Stevens,"28 Sep, 2020",Sales,Sales Lead,D,S
255,Nicolas,Zermati,"26 Oct, 2020",Engineering,Software Engineer,N,Z
164,Lea,Vaude,"3 Sep, 2024",Sales,Customer Success Manager,L,V`;

        // Main application
        function App() {
            const { useState, useEffect, useRef } = React;
            
            // States for login screen
            const [playerEmail, setPlayerEmail] = useState("");
            const [isPlaying, setIsPlaying] = useState(false);
            const [leaderboard, setLeaderboard] = useState([]);
            const [isLoadingLeaderboard, setIsLoadingLeaderboard] = useState(true);
            const [loginMessage, setLoginMessage] = useState("");
            const [isLoginError, setIsLoginError] = useState(false);
            
            // Game states
            const [employes, setEmployes] = useState([]);
            const [employesCharges, setEmployesCharges] = useState(false);
            const [recherche, setRecherche] = useState("");
            const [message, setMessage] = useState("");
            const [isError, setIsError] = useState(false);
            const [stats, setStats] = useState({ total: 0, decouverts: 0, score: 0 });
            const [indicesActives, setIndicesActives] = useState({
                communaute: false,
                role: false,
                initiales: false
            });
            const [seuilSimilarite, setSeuilSimilarite] = useState(0.8);
            const [jeuCommence, setJeuCommence] = useState(false);
            const [tempsRestant, setTempsRestant] = useState(1200); // 20 minutes in seconds
            const [jeuTermine, setJeuTermine] = useState(false);
            const timerRef = useRef(null);
            const scrollPositionRef = useRef(0);

            // Load leaderboard on startup
            useEffect(() => {
                loadLeaderboard();
            }, []);

            // Load leaderboard
            function loadLeaderboard() {
                setIsLoadingLeaderboard(true);
                db.collection("scores")
                    .orderBy("score", "desc")
                    .limit(10)
                    .get()
                    .then((snapshot) => {
                        const scores = [];
                        snapshot.forEach((doc) => {
                            scores.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        setLeaderboard(scores);
                        setIsLoadingLeaderboard(false);
                    })
                    .catch((error) => {
                        console.error("Error loading leaderboard:", error);
                        setIsLoadingLeaderboard(false);
                    });
            }

            // Function to save score and redirect to leaderboard
            function saveScore(forceScore = null, forceDiscovered = null) {
                if (!playerEmail) return;
                
                // Use forced values or current state values
                const scoreToSave = forceScore !== null ? forceScore : stats.score;
                const discoveredToSave = forceDiscovered !== null ? forceDiscovered : stats.decouverts;
                
                try {
                    // Check if player already has a score
                    db.collection("scores")
                        .where("email", "==", playerEmail)
                        .get()
                        .then((snapshot) => {
                            if (snapshot.empty) {
                                // Create a new score
                                return db.collection("scores").add({
                                    email: playerEmail,
                                    score: scoreToSave,
                                    discovered: discoveredToSave,
                                    total: stats.total,
                                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            } else {
                                // Update existing score if new score is higher
                                const doc = snapshot.docs[0];
                                const currentScore = doc.data().score;
                                if (scoreToSave > currentScore) {
                                    return db.collection("scores").doc(doc.id).update({
                                        score: scoreToSave,
                                        discovered: discoveredToSave,
                                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                } else {
                                    return Promise.resolve();
                                }
                            }
                        })
                        .then(() => {
                            loadLeaderboard();
                            setMessage("Your score has been saved!");
                            setIsError(false);
                            
                            // Redirect to leaderboard view
                            setIsPlaying(false);
                            setJeuCommence(false);
                            setJeuTermine(false);
                            setEmployesCharges(false);
                        })
                        .catch((error) => {
                            console.error("Error saving score:", error);
                            setMessage("Error saving your score. Please try again.");
                            setIsError(true);
                        });
                } catch (error) {
                    console.error("Error saving score:", error);
                    setMessage("Error saving your score. Please try again.");
                    setIsError(true);
                }
            }

            // Finish game and save score
            function finishGame() {
                if (!jeuCommence || jeuTermine) return;
                
                // Confirm before finishing
                if (window.confirm("Are you sure you want to finish the game and submit your score?")) {
                    // Clear timer
                    if (timerRef.current) {
                        clearInterval(timerRef.current);
                    }
                    
                    // Set game as finished
                    setJeuTermine(true);
                    
                    // Reveal all answers
                    setEmployes(function(prevEmployes) {
                        return prevEmployes.map(function(employe) {
                            return { ...employe, decouvert: true };
                        });
                    });
                    
                    // Save score and redirect to leaderboard
                    saveScore();
                }
            }

            // Load employee data
            useEffect(() => {
                if (isPlaying && !employesCharges) {
                    Papa.parse(donneesBrutes, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Transform data
                            const donnees = results.data.map(function(employe) {
                                return {
                                    id: employe.employee_id,
                                    prenom: employe.first_name,
                                    nom: employe.last_name,
                                    dateDebut: employe.original_start_date,
                                    communaute: employe.community,
                                    role: employe.role,
                                    initialePrenom: employe.first_initial,
                                    initialeNom: employe.last_initial,
                                    longueurNom: employe.last_name.length,
                                    decouvert: false
                                };
                            });
                            
                            // Sort employees by ID
                            donnees.sort(function(a, b) {
                                return parseInt(a.id) - parseInt(b.id);
                            });
                            
                            setEmployes(donnees);
                            setStats({ total: donnees.length, decouverts: 0, score: 0 });
                            setEmployesCharges(true);
                        }
                    });
                }
            }, [isPlaying, employesCharges]);

            // Timer management
            useEffect(() => {
                if (jeuCommence && !jeuTermine) {
                    timerRef.current = setInterval(function() {
                        setTempsRestant(function(prev) {
                            if (prev <= 1) {
                                clearInterval(timerRef.current);
                                
                                // Store current stats before state updates
                                const currentScore = stats.score;
                                const currentDiscovered = stats.decouverts;
                                
                                setJeuTermine(true);
                                
                                // Reveal all answers when time is up
                                setEmployes(function(prevEmployes) {
                                    return prevEmployes.map(function(employe) {
                                        return { ...employe, decouvert: true };
                                    });
                                });
                                
                                // Save score with the current values
                                saveScore(currentScore, currentDiscovered);
                                
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                
                return function() {
                    if (timerRef.current) {
                        clearInterval(timerRef.current);
                    }
                };
            }, [jeuCommence, jeuTermine]);

            // Start playing (after entering email)
            function handleStartPlaying(e) {
                e.preventDefault();
                if (!playerEmail || !playerEmail.includes('@')) {
                    setLoginMessage("Please enter a valid email address");
                    setIsLoginError(true);
                    return;
                }
                
                setIsPlaying(true);
            }

            // Start game
            function commencerJeu() {
                setJeuCommence(true);
                setTempsRestant(1200); // 20 minutes
                setJeuTermine(false);
                
                // Reset discovered employees
                setEmployes(function(prevEmployes) {
                    return prevEmployes.map(function(employe) {
                        return { ...employe, decouvert: false };
                    });
                });
                
                setStats(function(prev) { 
                    return { ...prev, decouverts: 0, score: 0 };
                });
                
                setMessage("Game started! You have 20 minutes to find as many names as possible.");
                setIsError(false);
            }

            // Format remaining time
            function formaterTemps(secondes) {
                const minutes = Math.floor(secondes / 60);
                const secondesRestantes = secondes % 60;
                return `${minutes.toString().padStart(2, '0')}:${secondesRestantes.toString().padStart(2, '0')}`;
            }

            // Calculate Levenshtein distance (similarity between two strings)
            function levenshteinDistance(a, b) {
                const matrix = [];
                
                // Increment
                function increment(i, j) {
                    return matrix[i][j] + 1;
                }
                
                // Insert
                function insertion(i, j) {
                    return matrix[i][j - 1] + 1;
                }
                
                // Substitute
                function substitution(i, j) {
                    return matrix[i - 1][j - 1] + (a[i - 1] !== b[j - 1] ? 1 : 0);
                }
                
                // Initialize matrix
                for (let i = 0; i <= a.length; i++) {
                    matrix[i] = [i];
                }
                
                for (let j = 1; j <= b.length; j++) {
                    matrix[0][j] = j;
                }
                
                // Fill matrix
                for (let i = 1; i <= a.length; i++) {
                    for (let j = 1; j <= b.length; j++) {
                        matrix[i][j] = Math.min(
                            increment(i - 1, j),     // deletion
                            insertion(i, j),         // insertion
                            substitution(i, j)       // substitution
                        );
                    }
                }
                
                return matrix[a.length][b.length];
            }

            // Calculate similarity between two strings (between 0 and 1)
            function calculateSimilarity(str1, str2) {
                const maxLength = Math.max(str1.length, str2.length);
                if (maxLength === 0) return 1.0; // If both strings are empty, they're identical
                
                const distance = levenshteinDistance(str1, str2);
                return 1.0 - distance / maxLength;
            }

            // Find best match for a searched name
            function trouverMeilleurMatch(nomRecherche) {
                let meilleurMatch = null;
                let meilleureSimilarite = 0;
                
                employes.forEach(function(employe) {
                    if (!employe.decouvert) {
                        const similarite = calculateSimilarity(
                            nomRecherche.toLowerCase(),
                            employe.nom.toLowerCase()
                        );
                        
                        if (similarite > meilleureSimilarite && similarite >= seuilSimilarite) {
                            meilleureSimilarite = similarite;
                            meilleurMatch = employe;
                        }
                    }
                });
                
                return { employe: meilleurMatch, similarite: meilleureSimilarite };
            }

            // Handle search form submission
            function verifierNom(e) {
                e.preventDefault();
                
                // Save current scroll position
                scrollPositionRef.current = window.scrollY;
                
                if (!jeuCommence || jeuTermine) {
                    setMessage(jeuTermine ? "Time's up! All answers are revealed." : "Click 'Start' to begin the game.");
                    setIsError(true);
                    return;
                }
                
                if (!recherche.trim()) {
                    setMessage("Please enter a name");
                    setIsError(true);
                    return;
                }
                
                const nomRecherche = recherche.trim().toLowerCase();
                
                // Check if name is exactly the same
                const employeExact = employes.find(
                    function(e) { return e.nom.toLowerCase() === nomRecherche && !e.decouvert; }
                );
                
                // If no exact match, look for best match
                if (!employeExact) {
                    const { employe: meilleurMatch, similarite } = trouverMeilleurMatch(nomRecherche);
                    
                    if (meilleurMatch) {
                        // Find approximate match
                        let pointsGagnes = 10; // Default: 10 points without hints
                        
                        // Calculate points based on hints used
                        if (indicesActives.communaute && indicesActives.role && indicesActives.initiales) {
                            pointsGagnes = 1; // 1 point with all hints
                        } else if ((indicesActives.communaute && indicesActives.role) || 
                                (indicesActives.communaute && indicesActives.initiales) || 
                                (indicesActives.role && indicesActives.initiales)) {
                            pointsGagnes = 3; // 3 points with two hints
                        } else if (indicesActives.communaute || indicesActives.role || indicesActives.initiales) {
                            pointsGagnes = 5; // 5 points with one hint
                        }
                        
                        // Slightly reduce points for approximate matches
                        pointsGagnes = Math.round(pointsGagnes * similarite);
                        
                        setStats(function(prev) { 
                            return { 
                                ...prev, 
                                decouverts: prev.decouverts + 1,
                                score: prev.score + pointsGagnes
                            };
                        });
                        
                        // Update employee as discovered
                        setEmployes(function(prev) {
                            return prev.map(function(e) {
                                return e.id === meilleurMatch.id ? { ...e, decouvert: true } : e;
                            });
                        });
                        
                        setMessage(`Well done! You found an employee with a similar name: "${meilleurMatch.prenom} ${meilleurMatch.nom}" (${Math.round(similarite * 100)}% similarity). +${pointsGagnes} points!`);
                        setIsError(false);
                        setRecherche("");
                        
                        // Restore scroll position after rendering
                        setTimeout(function() {
                            window.scrollTo(0, scrollPositionRef.current);
                        }, 0);
                        
                        return;
                    }
                    
                    // Check if employee has already been discovered
                    const employeDejaDecouvert = employes.find(
                        function(e) { return e.nom.toLowerCase() === nomRecherche && e.decouvert; }
                    );
                    
                    if (employeDejaDecouvert) {
                        setMessage(`You've already found ${employeDejaDecouvert.prenom} ${employeDejaDecouvert.nom}.`);
                        setIsError(true);
                    } else {
                        setMessage(`No employee found with the name "${recherche}".`);
                        setIsError(true);
                    }
                    
                    setRecherche("");
                    
                    // Restore scroll position after rendering
                    setTimeout(function() {
                        window.scrollTo(0, scrollPositionRef.current);
                    }, 0);
                    
                    return;
                }
                
                // Exact match found
                let pointsGagnes = 10; // Default: 10 points without hints
                
                // Calculate points based on hints used
                if (indicesActives.communaute && indicesActives.role && indicesActives.initiales) {
                    pointsGagnes = 1; // 1 point with all hints
                } else if ((indicesActives.communaute && indicesActives.role) || 
                        (indicesActives.communaute && indicesActives.initiales) || 
                        (indicesActives.role && indicesActives.initiales)) {
                    pointsGagnes = 3; // 3 points with two hints
                } else if (indicesActives.communaute || indicesActives.role || indicesActives.initiales) {
                    pointsGagnes = 5; // 5 points with one hint
                }
                
                setStats(function(prev) { 
                    return { 
                        ...prev, 
                        decouverts: prev.decouverts + 1,
                        score: prev.score + pointsGagnes
                    };
                });
                
                // Update employee as discovered
                setEmployes(function(prev) {
                    return prev.map(function(e) {
                        return e.id === employeExact.id ? { ...e, decouvert: true } : e;
                    });
                });
                
                setMessage(`Well done! You found ${employeExact.prenom} ${employeExact.nom}. +${pointsGagnes} points!`);
                setIsError(false);
                setRecherche("");
                
                // Restore scroll position after rendering
                setTimeout(function() {
                    window.scrollTo(0, scrollPositionRef.current);
                }, 0);
            }

            // Toggle hints
            function toggleIndice(indice) {
                if (!jeuCommence || jeuTermine) return;
                
                setIndicesActives(function(prev) {
                    const newState = { ...prev };
                    newState[indice] = !prev[indice];
                    return newState;
                });
            }

            // Change similarity threshold
            function changerSeuilSimilarite(e) {
                setSeuilSimilarite(parseFloat(e.target.value));
            }

            // Login screen display
            if (!isPlaying) {
                return React.createElement(
                    "div",
                    null,
                    [
                        // Main title
                        React.createElement(
                            "h1",
                            { style: { textAlign: "center", marginBottom: "30px" } },
                            "First 100 Alaners"
                        ),
                        
                        // Login form
                        React.createElement(
                            "div",
                            { className: "login-container" },
                            [
                                React.createElement("h2", null, "Enter your email to play"),
                                
                                React.createElement(
                                    "form",
                                    { onSubmit: handleStartPlaying },
                                    [
                                        React.createElement(
                                            "div",
                                            { style: { marginBottom: "15px" } },
                                            [
                                                React.createElement("label", { htmlFor: "email" }, "Your email:"),
                                                React.createElement("input", {
                                                    id: "email",
                                                    type: "email",
                                                    value: playerEmail,
                                                    onChange: (e) => setPlayerEmail(e.target.value),
                                                    placeholder: "example@alan.eu",
                                                    required: true
                                                })
                                            ]
                                        ),
                                        
                                        loginMessage && React.createElement(
                                            "div",
                                            { 
                                                className: isLoginError ? "error" : "success",
                                                style: { marginBottom: "15px" }
                                            },
                                            loginMessage
                                        ),
                                        
                                        React.createElement(
                                            "button",
                                            { 
                                                type: "submit",
                                                className: "start-button"
                                            },
                                            "Start Playing"
                                        )
                                    ]
                                )
                            ]
                        ),
                        
                        // Leaderboard
                        React.createElement(
                            "div",
                            { className: "container", style: { marginTop: "30px" } },
                            [
                                React.createElement(
                                    "h2",
                                    { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } },
                                    [
                                        "Leaderboard",
                                        React.createElement(
                                            "button",
                                            { 
                                                onClick: loadLeaderboard,
                                                style: { fontSize: "14px", padding: "5px 10px" }
                                            },
                                            "Refresh"
                                        )
                                    ]
                                ),
                                
                                isLoadingLeaderboard 
                                    ? React.createElement("p", null, "Loading leaderboard...")
                                    : React.createElement(
                                        "table",
                                        { className: "leaderboard-table" },
                                        [
                                            React.createElement(
                                                "thead",
                                                null,
                                                React.createElement(
                                                    "tr",
                                                    null,
                                                    [
                                                        React.createElement("th", null, "Rank"),
                                                        React.createElement("th", null, "Player"),
                                                        React.createElement("th", { style: { textAlign: "right" } }, "Score"),
                                                        React.createElement("th", { style: { textAlign: "right" } }, "Found")
                                                    ]
                                                )
                                            ),
                                            
                                            React.createElement(
                                                "tbody",
                                                null,
                                                leaderboard.length > 0 
                                                    ? leaderboard.map((entry, index) => 
                                                        React.createElement(
                                                            "tr",
                                                            { 
                                                                key: entry.id,
                                                                className: entry.email === playerEmail ? "highlight-row" : ""
                                                            },
                                                            [
                                                                React.createElement("td", null, `#${index + 1}`),
                                                                React.createElement("td", null, entry.email ? entry.email.split('@')[0] : "Anonymous"),
                                                                React.createElement("td", { style: { textAlign: "right", fontWeight: "bold" } }, entry.score),
                                                                React.createElement("td", { style: { textAlign: "right" } }, `${entry.discovered || 0}/${entry.total || 100}`)
                                                            ]
                                                        )
                                                    )
                                                    : React.createElement(
                                                        "tr",
                                                        null,
                                                        React.createElement(
                                                            "td",
                                                            { colSpan: 4, style: { textAlign: "center", padding: "15px" } },
                                                            "No scores recorded yet"
                                                        )
                                                    )
                                            )
                                        ]
                                    )
                            ]
                        )
                    ]
                );
            }

            // Loading message if data isn't loaded yet
            if (!employesCharges) {
                return React.createElement(
                    "div", 
                    { className: "container" },
                    React.createElement(
                        "div", 
                        { style: { textAlign: "center", padding: "50px" } },
                        "Loading data..."
                    )
                );
            }

            // Main game interface
            return React.createElement(
                "div",
                { className: "container" },
                [
                    // Title
                    React.createElement(
                        "h1",
                        { style: { textAlign: "center", marginBottom: "20px" } },
                        "First 100 Alaners"
                    ),
                    
                    // Instructions
                    React.createElement(
                        "div",
                        { style: { backgroundColor: "#f0f9ff", padding: "15px", borderRadius: "8px", marginBottom: "20px" } },
                        [
                            React.createElement(
                                "h2",
                                { style: { fontSize: "1.25rem", marginBottom: "10px" } },
                                "How to play:"
                            ),
                            React.createElement(
                                "ol",
                                { style: { paddingLeft: "20px" } },
                                [
                                    React.createElement("li", null, "Guess the last name of one of the first 100 Alan employees"),
                                    React.createElement("li", null, [
                                        React.createElement("strong", null, "10 points"),
                                        " per name found without hints"
                                    ]),
                                    React.createElement("li", null, [
                                        "Use hint buttons to help you:",
                                        React.createElement(
                                            "ul",
                                            { style: { paddingLeft: "20px", marginTop: "5px" } },
                                            [
                                                React.createElement("li", null, [
                                                    "With 1 hint: ",
                                                    React.createElement("strong", null, "5 points"),
                                                    " per name found"
                                                ]),
                                                React.createElement("li", null, [
                                                    "With 2 hints: ",
                                                    React.createElement("strong", null, "3 points"),
                                                    " per name found"
                                                ]),
                                                React.createElement("li", null, [
                                                    "With 3 hints: ",
                                                    React.createElement("strong", null, "1 point"),
                                                    " per name found"
                                                ])
                                            ]
                                        )
                                    ]),
                                    React.createElement("li", null, "Approximate spellings are accepted"),
                                    React.createElement("li", null, [
                                        "You have ",
                                        React.createElement("strong", null, "20 minutes"),
                                        " to find as many names as possible!"
                                    ])
                                ]
                            ),
                            
                            !jeuCommence && !jeuTermine ? React.createElement(
                                "div",
                                { style: { textAlign: "center", marginTop: "15px" } },
                                React.createElement(
                                    "button",
                                    { onClick: commencerJeu },
                                    "Start"
                                )
                            ) : null
                        ]
                    ),
                    
                    // Timer
                    React.createElement(
                        "div",
                        { 
                            className: `timer ${tempsRestant < 300 ? "ending" : ""}`,
                        },
                        [
                            React.createElement(
                                "div",
                                null,
                                formaterTemps(tempsRestant)
                            ),
                            
                            jeuCommence ? React.createElement(
                                "div",
                                { style: { fontSize: "14px" } },
                                jeuTermine ? "Time's up!" : "Time remaining"
                            ) : null
                        ]
                    ),
                    
                    // Search form
                    React.createElement(
                        "div",
                        { className: "sticky-search" },
                        [
                            React.createElement(
                                "form",
                                { onSubmit: verifierNom },
                                [
                                    React.createElement(
                                        "div",
                                        { style: { display: "flex", gap: "10px" } },
                                        [
                                            React.createElement(
                                                "input",
                                                {
                                                    type: "text",
                                                    value: recherche,
                                                    onChange: (e) => setRecherche(e.target.value),
                                                    placeholder: "Enter a last name...",
                                                    disabled: !jeuCommence || jeuTermine,
                                                    style: { 
                                                        flex: "1",
                                                        opacity: (!jeuCommence || jeuTermine) ? 0.7 : 1
                                                    }
                                                }
                                            ),
                                            React.createElement(
                                                "button",
                                                {
                                                    type: "submit",
                                                    disabled: !jeuCommence || jeuTermine,
                                                    style: {
                                                        opacity: (!jeuCommence || jeuTermine) ? 0.7 : 1
                                                    }
                                                },
                                                "Check"
                                            )
                                        ]
                                    )
                                ]
                            ),
                            
                            // Message
                            message && React.createElement(
                                "div",
                                { className: `message ${isError ? "error" : "success"}` },
                                message
                            )
                        ]
                    ),
                    
                    // Statistics and controls
                    React.createElement(
                        "div",
                        {
                            style: {
                                backgroundColor: "#f9fafb",
                                padding: "15px",
                                borderRadius: "8px",
                                marginBottom: "20px",
                                display: "flex",
                                flexDirection: "column",
                                gap: "15px"
                            }
                        },
                        [
                            // Statistics
                            React.createElement(
                                "div",
                                null,
                                [
                                    React.createElement(
                                        "div",
                                        null,
                                        `Progress: ${stats.decouverts} / ${stats.total} employees found`
                                    ),
                                    React.createElement(
                                        "div",
                                        { style: { fontSize: "18px", fontWeight: "bold" } },
                                        `Score: ${stats.score} points`
                                    ),
                                    React.createElement(
                                        "div",
                                        null,
                                        `Player: ${playerEmail.split('@')[0]}`
                                    )
                                ]
                            ),
                            
                            // Hint buttons
                            React.createElement(
                                "div",
                                { style: { display: "flex", flexWrap: "wrap", gap: "10px" } },
                                [
                                    // Hint: Community
                                    React.createElement(
                                        "button",
                                        {
                                            onClick: () => toggleIndice('communaute'),
                                            disabled: !jeuCommence || jeuTermine,
                                            className: indicesActives.communaute ? "hint-button active" : "hint-button",
                                            style: {
                                                opacity: (!jeuCommence || jeuTermine) ? 0.7 : 1
                                            }
                                        },
                                        indicesActives.communaute ? 'Hide community' : 'Hint: Community'
                                    ),
                                    
                                    // Hint: Role
                                    React.createElement(
                                        "button",
                                        {
                                            onClick: () => toggleIndice('role'),
                                            disabled: !jeuCommence || jeuTermine,
                                            className: indicesActives.role ? "hint-button active" : "hint-button",
                                            style: {
                                                opacity: (!jeuCommence || jeuTermine) ? 0.7 : 1
                                            }
                                        },
                                        indicesActives.role ? 'Hide role' : 'Hint: Role'
                                    ),
                                    
                                    // Hint: Initials
                                    React.createElement(
                                        "button",
                                        {
                                            onClick: () => toggleIndice('initiales'),
                                            disabled: !jeuCommence || jeuTermine,
                                            className: indicesActives.initiales ? "hint-button active" : "hint-button",
                                            style: {
                                                opacity: (!jeuCommence || jeuTermine) ? 0.7 : 1
                                            }
                                        },
                                        indicesActives.initiales ? 'Hide initials' : 'Hint: Initials'
                                    )
                                ]
                            ),
                            
                            // Action buttons
                            React.createElement(
                                "div",
                                { className: "actions-container" },
                                [
                                    // Finish button (only visible during active game)
                                    jeuCommence && !jeuTermine && React.createElement(
                                        "button",
                                        {
                                            onClick: finishGame,
                                            className: "finish-button"
                                        },
                                        "Finish"
                                    )
                                    
                                    // "Change Email" button removed as requested
                                ]
                            )
                        ]
                    ),
                    
                    // Similarity threshold setting
                    React.createElement(
                        "div",
                        {
                            style: {
                                backgroundColor: "#f0f9ff",
                                padding: "15px",
                                borderRadius: "8px",
                                marginBottom: "20px"
                            }
                        },
                        [
                            React.createElement(
                                "div",
                                { style: { fontWeight: "500", marginBottom: "10px" } },
                                `Matching sensitivity: ${Math.round(seuilSimilarite * 100)}%`
                            ),
                            React.createElement(
                                "input",
                                {
                                    type: "range",
                                    min: "0.5",
                                    max: "0.95",
                                    step: "0.05",
                                    value: seuilSimilarite,
                                    onChange: changerSeuilSimilarite,
                                    className: "sensitivity-slider"
                                }
                            ),
                            React.createElement(
                                "div",
                                { style: { display: "flex", justifyContent: "space-between", fontSize: "14px", color: "#6b7280" } },
                                [
                                    React.createElement("span", null, "More flexible"),
                                    React.createElement("span", null, "More strict")
                                ]
                            )
                        ]
                    ),
                    
                    // Employee list
                    React.createElement(
                        "div",
                        { className: "employee-list" },
                        [
                            // Title
                            React.createElement(
                                "div",
                                { className: "employee-list-header" },
                                `Employee List (${employes.length})`
                            ),
                            
                            // Employee table
                            React.createElement(
                                "table",
                                { className: "employee-table" },
                                [
                                    // Table header
                                    React.createElement(
                                        "thead",
                                        null,
                                        React.createElement(
                                            "tr",
                                            null,
                                            [
                                                React.createElement("th", null, "ID"),
                                                React.createElement("th", null, "Start Date"),
                                                indicesActives.communaute && React.createElement("th", null, "Community"),
                                                indicesActives.role && React.createElement("th", null, "Role"),
                                                indicesActives.initiales && React.createElement("th", null, "Initials"),
                                                React.createElement("th", null, "Full Name")
                                            ].filter(Boolean) // Filter out null elements
                                        )
                                    ),
                                    
                                    // Table body
                                    React.createElement(
                                        "tbody",
                                        null,
                                        employes.map(function(employe, idx) {
                                            return React.createElement(
                                                "tr",
                                                { key: employe.id },
                                                [
                                                    React.createElement("td", null, employe.id),
                                                    React.createElement("td", null, employe.dateDebut),
                                                    indicesActives.communaute && React.createElement("td", null, employe.communaute),
                                                    indicesActives.role && React.createElement("td", null, employe.role),
                                                    indicesActives.initiales && React.createElement(
                                                        "td",
                                                        null,
                                                        `${employe.initialePrenom}. ${employe.initialeNom}.`
                                                    ),
                                                    React.createElement(
                                                        "td",
                                                        null,
                                                        employe.decouvert 
                                                            ? React.createElement("span", { style: { fontWeight: "500" } }, `${employe.prenom} ${employe.nom}`)
                                                            : React.createElement("span", { className: "hidden-name" }, "● ●")
                                                    )
                                                ].filter(Boolean) // Filter out null elements
                                            );
                                        })
                                    )
                                ]
                            )
                        ]
                    ),
                    
                    // Game over message
                    jeuTermine && React.createElement(
                        "div",
                        { 
                            style: { 
                                backgroundColor: "#fee2e2", 
                                padding: "20px", 
                                borderRadius: "8px", 
                                textAlign: "center", 
                                marginTop: "20px" 
                            } 
                        },
                        [
                            React.createElement("h2", { style: { color: "#b91c1c" } }, "Time's up!"),
                            React.createElement(
                                "p",
                                null,
                                [
                                    "You found ",
                                    React.createElement("strong", null, stats.decouverts),
                                    ` employees out of ${stats.total} and scored `,
                                    React.createElement("strong", null, stats.score),
                                    " points."
                                ]
                            ),
                            React.createElement(
                                "p",
                                { style: { fontStyle: "italic", margin: "10px 0" } },
                                "Your score is being saved. You'll be redirected to the leaderboard shortly..."
                            ),
                            
                            // Play again button
                            React.createElement(
                                "div",
                                { className: "actions-container" },
                                [
                                    React.createElement(
                                        "button",
                                        { 
                                            onClick: () => {
                                                if (timerRef.current) {
                                                    clearInterval(timerRef.current);
                                                }
                                                
                                                setEmployes(employes.map(function(e) { return { ...e, decouvert: false }; }));
                                                setStats({ total: employes.length, decouverts: 0, score: 0 });
                                                setIndicesActives({ communaute: false, role: false, initiales: false });
                                                setJeuCommence(false);
                                                setJeuTermine(false);
                                                setTempsRestant(1200);
                                                setMessage("Game reset! Click 'Start' to begin a new game.");
                                                setIsError(false);
                                            },
                                            style: {
                                                backgroundColor: "#3b82f6"
                                            }
                                        },
                                        "Play Again"
                                    )
                                ]
                            )
                        ]
                    )
                ]
            );
        }

        // Render the application
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
